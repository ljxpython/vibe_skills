---
description: "测试门禁：按 test-coverage 生成测试计划并写入 docs/test-plan.md（PASS/BLOCK）。"
agent: build
---

执行测试计划门禁（每次改动都必须）。

路由提示（强制）：
- 生成结论由 @gate-test 负责
- 落盘由 @scribe 负责写入 docs/test-plan.md

步骤：
1) 确保 `docs/` 存在；确保 `docs/test-plan.md` 存在。
2) 读取模板：
   - `.opencode/skills/test-coverage/references/test-template.md`
   - `.opencode/skills/test-coverage/references/api-scan.md`
3) 优先运行脚本补齐信息：
   - `python3 .opencode/skills/test-coverage/scripts/scan_apis.py --json`（可失败则降级手工）
   - `python3 .opencode/skills/test-coverage/scripts/diff_map.py --json`（可失败则降级 git diff）
4) 委托 @gate-test 生成测试计划（覆盖：本次改动 + E2E + 核心逻辑 + 每接口）与 PASS/BLOCK。
5) 委托 @scribe 将结果追加写入 `docs/test-plan.md`。
